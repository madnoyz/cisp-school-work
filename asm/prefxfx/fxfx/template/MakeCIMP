ASFLAGS = -g
CFLAGS = -g -DCIMP
LDFLAGS = -g
CSRC = mainC.c
ASRC = 
EXE = mainC

$(EXE):	$(CSRC:.c=.o) $(ASRC:.S=.o)

mainC.c:	main.c
	cp main.c mainC.c

%.d: %.c  
	set -e; gcc $(CFLAGS) $^ -MM \
	| sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' > $@; \
	[ -s $@ ] || rm -f $@  

%.d: %.S  
	set -e; gcc $(ASFLAGS) $^ -MM \
	| sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' > $@; \
	[ -s $@ ] || rm -f $@  

clean:
	rm -f $(EXE) \
	  $(CSRC:.c=.o) $(CSRC:.c=.d) \
	  $(ASRC:.s=.o) \
	  mainC.c

include $(CSRC:.c=.d)
